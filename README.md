# lazyent

一个 Ent 生成器插件，用于从 Ent Schema 生成 Domain Entity 与 DTO 定义 Protobuf Message。
主要为 Clean Architecture (Kratos) 设计模式提供支持。

## 特点

- 自动更新字段定义，修改字段时只需修改 Ent Schema
- Domain Entity 与 DTO 定义 Protobuf Message 保持一致
- 自动生成 mapper 函数，开箱即用
- 高度可自定义化

## 安装与使用

```bash
go install github.com/Cromemadnd/lazyent@latest
```

然后，如果你的目录下的 `generate.go` 还是 ent 默认提供的，你需要更改它以使用 `entc.go`。

```go
/* generate.go */
package ent

//go:generate go run -mod=mod entc.go
```

然后在你的 `entc.go` 中集成 `lazyent`。

```go
/* entc.go */

//go:build ignore

package main

import (
	"log"

	"entgo.io/ent/entc"
	"entgo.io/ent/entc/gen"
	"github.com/Cromemadnd/lazyent"
)

func main() {
	// 配置生成选项
	opts := []entc.Option{
		entc.Extensions(lazyent.NewExtension(
			lazyent.Config{
				ProtoOut:   "api/user/v1", // 配置生成的 proto 文件输出目录
				ServiceOut: "internal/user/service", // 配置生成的 service 文件输出目录
				BizOut:     "internal/user/biz", // 配置生成的 biz 文件输出目录
				DataOut:    "internal/user/data", // 配置生成的 data 文件输出目录
				SingleFile: true, // 是否将所有 schema 的代码合并到一个文件中
			},
			lazyent.WithProtoPackage("my.project.api.v1"), // 配置生成的 proto 文件的 package
			lazyent.WithBizEntityFileName("entities.go"), // 配置生成的 biz entity 文件名
		)),
	}

	// 执行 Ent 代码生成
	// 假设 schema 文件位于 ./schema 目录
	if err := entc.Generate("./schema", &gen.Config{
		Header: "// Code generated by ent, DO NOT EDIT.",
		// 可以添加其他 gen.Config 配置，例如 Features 等
	}, opts...); err != nil {
		log.Fatalf("running ent codegen: %v", err)
	}
}
```