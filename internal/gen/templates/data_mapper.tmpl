{{/* data.tmpl - 生成 internal/data/_ent.go */}}
// Code generated by lazyent. DO NOT EDIT.
package data

import (
	"{{ .BizPackage }}"
	"{{ .EntPackage }}"
)


{{- range .Nodes }}
{{- $node := . }}
func Ent{{ .Name }}ToBiz(e *ent.{{ .Name }}) (*biz.{{ .Name }}, error) {
	if e == nil {
		return nil, errors.New("Ent{{ .Name }}ToBiz: nil entity")
	}
{{- range $e := .Edges }}
{{- if isBizExclude $e }}{{ continue }}{{ end }}
{{- if not $e.Unique }}
	{{- if isBizIDOnly $e }}
	var {{ camel (bizEdgeName $e) }} []string
	for _, item := range e.Edges.{{ $e.StructField }} {
		{{ camel (bizEdgeName $e) }} = append({{ camel (bizEdgeName $e) }}, item.ID.String())
	}
	{{- else }}
	var {{ camel (bizEdgeName $e) }} []*biz.{{ $e.Type.Name }}
	for _, item := range e.Edges.{{ $e.StructField }} {
		v, err := Ent{{ $e.Type.Name }}ToBiz(item)
		if err != nil {
			return nil, err
		}
		{{ camel (bizEdgeName $e) }} = append({{ camel (bizEdgeName $e) }}, v)
	}
	{{- end }}
{{- else }}
	{{- if not (isBizIDOnly $e) }}
	{{ camel (bizEdgeName $e) }}, err := Ent{{ $e.Type.Name }}ToBiz(e.Edges.{{ $e.StructField }})
	if err != nil {
		return nil, err
	}
	{{- end }}
{{- end }}
{{- end }}
	return &biz.{{ .Name }}{
		{{ .Name }}Base: biz.{{ .Name }}Base{
			UUID: e.ID.String(),
			{{- range $f := .Fields }}
			{{- if not (isSensitive $f) }}
			{{ bizFieldName $f }}: {{ convertEntToBiz $f $node.Name (printf "e.%s" $f.StructField) }},
			{{- end }}
			{{- end }}
			{{- range $e := .Edges }}
			{{- if isBizExclude $e }}{{ continue }}{{ end }}
			{{- if $e.Unique }}
			{{- /* Single Relationship */}}
			{{- if isBizIDOnly $e }}
			{{ bizEdgeName $e }}: func() {{ edgeIDType $e }} {
				if e.Edges.{{ $e.StructField }} != nil {
					return e.Edges.{{ $e.StructField }}.ID.String()
				}
				return {{ zeroValue (edgeIDType $e) }}
			}(),
			{{- else }}
			{{ bizEdgeName $e }}: {{ camel (bizEdgeName $e) }},
			{{- end }}
			{{- else }}
			{{- /* List Relationship */}}
			{{ bizEdgeName $e }}: {{ camel (bizEdgeName $e) }},
			{{- end }}
			{{- end }}
		},
	}, nil
}

func Biz{{ .Name }}ToEnt(b *biz.{{ .Name }}) (*ent.{{ .Name }}, error) {
	if b == nil {
		return nil, errors.New("Biz{{ .Name }}ToEnt: nil entity")
	}
{{- range $e := .Edges }}
{{- if isBizExclude $e }}{{ continue }}{{ end }}
{{- if $e.Unique }}
	{{- if not (isBizIDOnly $e) }}
	{{ camel (bizEdgeName $e) }}, err := Biz{{ $e.Type.Name }}ToEnt(b.{{ bizEdgeName $e }})
	if err != nil {
		return nil, err
	}
	{{- end }}
{{- else }}
	{{- if isBizIDOnly $e }}
	var {{ camel $e.StructField }} []*ent.{{ $e.Type.Name }}
	for _, item := range b.{{ bizEdgeName $e }} {
		val, err := uuid.Parse(item)
		if err != nil {
			return nil, err
		}
		{{ camel $e.StructField }} = append({{ camel $e.StructField }}, &ent.{{ $e.Type.Name }}{
			ID: val,
		})
	}
	{{- else }}
	var {{ camel $e.StructField }} []*ent.{{ $e.Type.Name }}
	for _, item := range b.{{ bizEdgeName $e }} {
		v, err := Biz{{ $e.Type.Name }}ToEnt(item)
		if err != nil {
			return nil, err
		}
		{{ camel $e.StructField }} = append({{ camel $e.StructField }}, v)
	}
	{{- end }}
{{- end }}
{{- end }}
	id, err := uuid.Parse(b.UUID)
	if err != nil {
		return nil, err
	}
{{- range $f := .Fields }}
	{{- if and (not (isSensitive $f)) (eq $f.Type.String "uuid.UUID") }}
	{{- if $f.Nillable }}
	var {{ camel $f.StructField }} *uuid.UUID
	if b.{{ bizFieldName $f }} != "" {
		parsed, err := uuid.Parse(b.{{ bizFieldName $f }})
		if err != nil {
			return nil, err
		}
		{{ camel $f.StructField }} = &parsed
	}
	{{- else }}
	{{ camel $f.StructField }}, err := uuid.Parse(b.{{ bizFieldName $f }})
	if err != nil {
		return nil, err
	}
	{{- end }}
	{{- end }}
{{- end }}
	return &ent.{{ .Name }}{
		ID:        id,
{{- range $f := .Fields }}
		{{- if not (isSensitive $f) }}
		{{- if eq $f.Type.String "uuid.UUID" }}
		{{ $f.StructField }}: {{ camel $f.StructField }},
		{{- else }}
		{{ $f.StructField }}: {{ convertBizToEnt $f $node.Name (printf "b.%s" (bizFieldName $f)) }},
		{{- end }}
		{{- end }}
{{- end }}
{{- if .Edges }}
		Edges: ent.{{ .Name }}Edges{
{{- range $e := .Edges }}
{{- if isBizExclude $e }}{{ continue }}{{ end }}
			{{ $e.StructField }}: {{ camel $e.StructField }},
{{- end }}
		},
{{- end }}
	}, nil
}


{{/* 生成 Enum Converters - 只为内部枚举生成，外部枚举类型不需要转换 */}}
{{- range $f := .Fields }}{{ if and .IsEnum (not (isExternalEnum $f)) }}

func Ent{{ $node.Name }}{{ $f.StructField }}ToBiz(v {{ $node.Name | lower }}.{{ $f.StructField }}) biz.{{ $node.Name }}{{ $f.StructField }} {
	switch v {
{{- range $pair := getEnumPairs $f }}
	case {{ $node.Name | lower }}.{{ $f.StructField }}{{ $pair.Key | upper }}:
		return biz.{{ $node.Name }}{{ $f.StructField }}{{ $pair.Key | pascal }}
{{- end }}
	default:
		return 0
	}
}

func Biz{{ $node.Name }}{{ $f.StructField }}ToEnt(v biz.{{ $node.Name }}{{ $f.StructField }}) {{ $node.Name | lower }}.{{ $f.StructField }} {
	switch v {
{{- range $pair := getEnumPairs $f }}
	case biz.{{ $node.Name }}{{ $f.StructField }}{{ $pair.Key | pascal }}:
		return {{ $node.Name | lower }}.{{ $f.StructField }}{{ $pair.Key | upper }}
{{- end }}
	default:
		return ""
	}
}
{{- end }}{{ end }}
{{- end }}
