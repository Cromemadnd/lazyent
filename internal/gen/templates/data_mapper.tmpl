{{/* data.tmpl - 生成 internal/data/_ent.go */}}
// Code generated by lazyent. DO NOT EDIT.
package data

import (
	"{{ .BizPackage }}"
	"{{ .EntPackage }}"
)


{{- range .Nodes }}
{{- $node := . }}
func Ent{{ .Name }}ToBiz(e *ent.{{ .Name }}) (*biz.{{ .Name }}, error) {
	if e == nil {
		return nil, nil
	}
{{- range $e := .Edges }}
{{- if not (shouldGenerateBizEdge $e) }}{{ continue }}{{ end }}
{{- if not $e.Unique }}
	{{- if isBizIDOnly $e false }}
	var {{ camel (bizEdgeName $e false) }} []string
	for _, item := range e.Edges.{{ $e.StructField }} {
		{{ camel (bizEdgeName $e false) }} = append({{ camel (bizEdgeName $e false) }}, item.ID.String())
	}
	{{- else }}
	var {{ camel (bizEdgeName $e false) }} []*biz.{{ $e.Type.Name }}
	for _, item := range e.Edges.{{ $e.StructField }} {
		v, err := Ent{{ $e.Type.Name }}ToBiz(item)
		if err != nil {
			return nil, err
		}
		{{ camel (bizEdgeName $e false) }} = append({{ camel (bizEdgeName $e false) }}, v)
	}
	{{- end }}
{{- else }}
	{{- if not (isBizIDOnly $e false) }}
	{{ camel (bizEdgeName $e false) }}, err := Ent{{ $e.Type.Name }}ToBiz(e.Edges.{{ $e.StructField }})
	if err != nil {
		return nil, err
	}
	{{- end }}
{{- end }}
{{- end }}
	return &biz.{{ .Name }}{
		{{ .Name }}Base: biz.{{ .Name }}Base{
			{{- if .ID }}
			{{ bizFieldName .ID }}: {{ convertEntToBiz .ID $node.Name "e.ID" }},
			{{- end }}
			{{- range $f := .Fields }}
			{{- if and (shouldGenerateBizField $f) (not (isVirtual $f)) }}
			{{ bizFieldName $f }}: {{ convertEntToBiz $f $node.Name (printf "e.%s" $f.StructField) }},
			{{- end }}
			{{- end }}
			{{- range $e := .Edges }}
			{{- if not (shouldGenerateBizEdge $e) }}{{ continue }}{{ end }}
			{{- if $e.Unique }}
			{{- /* Single Relationship */}}
			{{- if isBizIDOnly $e false }}
			{{ bizEdgeName $e false }}: func() {{ edgeIDType $e }} {
				if e.Edges.{{ $e.StructField }} != nil {
					{{- if eq (edgeIDType $e) "uuid.UUID" }}
					return e.Edges.{{ $e.StructField }}.ID.String()
					{{- else }}
					return {{ edgeIDType $e }}(e.Edges.{{ $e.StructField }}.ID)
					{{- end }}
				}
				return {{ zeroValue (edgeIDType $e) }}
			}(),
			{{- else }}
			{{ bizEdgeName $e false }}: {{ camel (bizEdgeName $e false) }},
			{{- end }}
			{{- else }}
			{{- /* List Relationship */}}
			{{ bizEdgeName $e false }}: {{ camel (bizEdgeName $e false) }},
			{{- end }}
			{{- end }}
		},
	}, nil
}

func Biz{{ .Name }}ToEnt(b *biz.{{ .Name }}) (*ent.{{ .Name }}, error) {
	if b == nil {
		return nil, nil
	}
{{- range $e := .Edges }}
{{- if not (shouldGenerateBizEdge $e) }}{{ continue }}{{ end }}
{{- if $e.Unique }}
	{{- if not (isBizIDOnly $e false) }}
	{{ camel (bizEdgeName $e false) }}, err := Biz{{ $e.Type.Name }}ToEnt(b.{{ bizEdgeName $e false }})
	if err != nil {
		return nil, err
	}
	{{- end }}
{{- else }}
	{{- if isBizIDOnly $e false }}
	var {{ camel $e.StructField }} []*ent.{{ $e.Type.Name }}
	for _, item := range b.{{ bizEdgeName $e false }} {
		{{- if eq (edgeIDType $e) "uuid.UUID" }}
		val, err := uuid.Parse(item)
		if err != nil {
			return nil, err
		}
		{{ camel $e.StructField }} = append({{ camel $e.StructField }}, &ent.{{ $e.Type.Name }}{
			ID: val,
		})
		{{- else }}
		{{ camel $e.StructField }} = append({{ camel $e.StructField }}, &ent.{{ $e.Type.Name }}{
			ID: {{ edgeIDType $e }}(item),
		})
		{{- end }}
	}
	{{- else }}
	var {{ camel $e.StructField }} []*ent.{{ $e.Type.Name }}
	for _, item := range b.{{ bizEdgeName $e false }} {
		v, err := Biz{{ $e.Type.Name }}ToEnt(item)
		if err != nil {
			return nil, err
		}
		{{ camel $e.StructField }} = append({{ camel $e.StructField }}, v)
	}
	{{- end }}
{{- end }}
{{- end }}
{{- if .ID }}
{{- if requiresErrorCheck .ID "BizToEnt" }}
	{{ convertBizToEntSetup .ID $node.Name }}
{{- end }}
{{- end }}
{{- range $f := .Fields }}
{{- if and (requiresErrorCheck $f "BizToEnt") (not (isVirtual $f)) }}
	{{ convertBizToEntSetup $f $node.Name }}
{{- end }}
{{- end }}
	return &ent.{{ .Name }}{
{{- if .ID }}
		ID: {{ convertBizToEntUsage .ID $node.Name }},
{{- end }}
{{- range $f := .Fields }}
		{{- if and (shouldGenerateBizField $f) (not (isVirtual $f)) }}
		{{ $f.StructField }}: {{ convertBizToEntUsage $f $node.Name }},
		{{- end }}
{{- end }}
{{- if .Edges }}
		Edges: ent.{{ .Name }}Edges{
{{- range $e := .Edges }}
{{- if not (shouldGenerateBizEdge $e) }}{{ continue }}{{ end }}
			{{ $e.StructField }}: {{ camel $e.StructField }},
{{- end }}
		},
{{- end }}
	}, nil
}


{{/* 生成 Enum Converters - 只为内部枚举生成，外部枚举类型不需要转换 */}}
{{- range $f := .Fields }}{{ if and .IsEnum (not (isExternalEnum $f)) }}

func Ent{{ $node.Name }}{{ $f.StructField }}ToBiz(v {{ $node.Name | lower }}.{{ $f.StructField }}) biz.{{ $node.Name }}{{ $f.StructField }} {
	switch v {
{{- range $pair := getEnumPairs $f }}
	case {{ $node.Name | lower }}.{{ $f.StructField }}{{ $pair.Key | upper }}:
		return biz.{{ $node.Name }}{{ $f.StructField }}{{ $pair.Key | pascal }}
{{- end }}
	default:
		return 0
	}
}

func Biz{{ $node.Name }}{{ $f.StructField }}ToEnt(v biz.{{ $node.Name }}{{ $f.StructField }}) {{ $node.Name | lower }}.{{ $f.StructField }} {
	switch v {
{{- range $pair := getEnumPairs $f }}
	case biz.{{ $node.Name }}{{ $f.StructField }}{{ $pair.Key | pascal }}:
		return {{ $node.Name | lower }}.{{ $f.StructField }}{{ $pair.Key | upper }}
{{- end }}
	default:
		return ""
	}
}
{{- end }}{{ end }}
{{- end }}
