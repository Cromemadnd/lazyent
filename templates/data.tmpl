{{/* data.tmpl - 生成 internal/data/_ent.go */}}
package data

import (
	"{{ .EntPackage }}"
	"{{ .BizPackage }}"
{{- if hasTimeNodes .Nodes }}
	"time"
{{- end }}
{{- if hasUUIDNodes .Nodes }}
	"github.com/google/uuid"
{{- end }}
{{- range .Nodes }}
{{- $node := . }}
{{- range .Fields }}{{ if .IsEnum }}
	"{{ $.EntPackage }}/{{ $node.Name | lower }}"
{{- end }}{{ end }}
{{- end }}
)

{{- range .Nodes }}
{{- $node := . }}
// Ent{{ .Name }}ToBiz 将 Ent 实体转换为 Biz 实体
func Ent{{ .Name }}ToBiz(e *ent.{{ .Name }}) *biz.{{ .Name }} {
	if e == nil {
		return nil
	}
	return &biz.{{ .Name }}{
		{{ .Name }}Base: biz.{{ .Name }}Base{
{{- range $f := .Fields }}
{{- if $f.IsEnum }}
			{{ $f.StructField }}: convert{{ $node.Name }}{{ $f.StructField }}ToBiz(e.{{ $f.StructField }}),
{{- else }}
			{{ $f.StructField }}: e.{{ $f.StructField }},
{{- end }}
{{- end }}
{{- range $e := .Edges }}
{{- if and (edgeHasFK $e) (not (hasField $node.Fields (edgeField $e))) }}
			{{ edgeField $e }}: func() {{ edgeIDType $e }} {
				if e.Edges.{{ $e.StructField }} != nil {
					return e.Edges.{{ $e.StructField }}.ID
				}
				return {{ zeroValue (edgeIDType $e) }}
			}(),
{{- end }}
{{- end }}
		},
	}
}

// Biz{{ .Name }}ToEnt 将 Biz 实体转换为 Ent 实体
func Biz{{ .Name }}ToEnt(b *biz.{{ .Name }}) *ent.{{ .Name }} {
	if b == nil {
		return nil
	}
	return &ent.{{ .Name }}{
{{- range $f := .Fields }}
{{- if $f.IsEnum }}
		{{ $f.StructField }}: convertBiz{{ $node.Name }}{{ $f.StructField }}ToEnt(b.{{ $f.StructField }}),
{{- else }}
		{{ $f.StructField }}: b.{{ $f.StructField }},
{{- end }}
{{- end }}
{{- range $e := .Edges }}
{{- if hasField $node.Fields (edgeField $e) }}
		{{ edgeField $e }}: b.{{ edgeField $e }},
{{- end }}
{{- end }}
	}
}

{{/* 生成 Enum Converters */}}
{{- range $f := .Fields }}{{ if .IsEnum }}
func convert{{ $node.Name }}{{ $f.StructField }}ToBiz(v {{ $node.Name | lower }}.{{ $f.StructField }}) biz.{{ $node.Name }}{{ $f.StructField }} {
	switch v {
{{- range $k, $v := getEnumValues $f }}
	case {{ $node.Name | lower }}.{{ $f.StructField }}{{ $k }}:
		return biz.{{ $node.Name }}{{ $f.StructField }}{{ $k }}
{{- end }}
	default:
		return 0
	}
}

func convertBiz{{ $node.Name }}{{ $f.StructField }}ToEnt(v biz.{{ $node.Name }}{{ $f.StructField }}) {{ $node.Name | lower }}.{{ $f.StructField }} {
	switch v {
{{- range $k, $v := getEnumValues $f }}
	case biz.{{ $node.Name }}{{ $f.StructField }}{{ $k }}:
		return {{ $node.Name | lower }}.{{ $f.StructField }}{{ $k }}
{{- end }}
	default:
		return ""
	}
}
{{- end }}{{ end }}
{{- end }}
